(function(){"use strict";var e={4399:function(e,t,s){var a=s(144),r=s(998),i=s(6232),o=s(3423),n=s(6190),l=s(2118),c=s(5808),u=s(4525),d=s(6098),m=s(3059),h=s(4528),p=s(9258),f=s(3687),b=s(7953),v=(s(7658),function(){var e=this,t=e._self._c;return t(r.Z,[t(i.Z,{attrs:{app:"",color:"green",dark:""}},[t(b.qW,{staticStyle:{cursor:"pointer"},on:{click:function(t){return e.$router.push("/")}}},[e._v(e._s(e.appName))]),t(f.Z),e.loginStatus?t(b.lj,[t(h.Z,{attrs:{"offset-y":"","open-on-hover":""},scopedSlots:e._u([{key:"activator",fn:function({on:s}){return[t(n.Z,e._g({staticStyle:{cursor:"default"},attrs:{text:""}},s),[t(o.Z,{staticClass:"mr-3",attrs:{size:"40"}},[t("img",{attrs:{src:e.userIcon}})]),e._v(e._s(e.userName))],1)]}}],null,!1,4007436275)},[t(c.Z,[t(u.Z,{attrs:{link:""}},[t(d.km,[t(d.V9,{on:{click:e.logout}},[e._v("ログアウト")])],1)],1)],1)],1),t(h.Z,{attrs:{"offset-y":"","open-on-hover":""},scopedSlots:e._u([{key:"activator",fn:function({on:s}){return[t(n.Z,e._g({staticStyle:{cursor:"default"},attrs:{text:""}},s),[e._v("設定")])]}}],null,!1,2185790517)},[t(c.Z,[t(u.Z,{attrs:{link:"",to:"/admins"}},[t(d.km,[t(d.V9,[e._v("管理者設定")])],1)],1),t(u.Z,{attrs:{link:"",to:"/departments"}},[t(d.km,[t(d.V9,[e._v("部署設定")])],1)],1),t(u.Z,{attrs:{link:"",to:"/users"}},[t(d.km,[t(d.V9,[e._v("従業員設定")])],1)],1),t(u.Z,{attrs:{link:"",to:"/routes"}},[t(d.km,[t(d.V9,[e._v("申請ルート設定")])],1)],1),t(u.Z,{attrs:{link:"",to:"/settings"}},[t(d.km,[t(d.V9,[e._v("アプリ設定")])],1)],1),t(u.Z,{attrs:{link:"",to:"/test"}},[t(d.km,[t(d.V9,[e._v("テスト")])],1)],1)],1)],1)],1):e._e()],1),t(m.Z,[t(l.Z,{attrs:{fluid:""}},[t("router-view")],1)],1),t(p.Z,{attrs:{color:"info"},scopedSlots:e._u([{key:"action",fn:function({attrs:s}){return[t(n.Z,e._b({attrs:{text:""},on:{click:function(t){e.snackbar=!1}}},"v-btn",s,!1),[e._v("Close")])]}}]),model:{value:e.snackbar,callback:function(t){e.snackbar=t},expression:"snackbar"}},[e._v(" "+e._s(e.message)+" ")])],1)}),g=[],k=s(629),y={name:"App",data(){return{snackbar:!1,message:""}},computed:{...(0,k.rn)({appName:e=>e.workflow.settings.appName,authMessage:e=>e.firebase.authMessage,workflowMessage:e=>e.firestore.workflowMessage}),...(0,k.Se)({userName:"firebase/getUserName",userIcon:"firebase/getUserIcon",loginStatus:"firebase/getLoginStatus"})},beforeCreate(){this.$store.dispatch("workflow/loadSettings")},methods:{async logout(){await this.$store.dispatch("firebase/logout")}},watch:{authMessage(){this.message=this.authMessage,this.snackbar=!0},workflowMessage(){this.message=this.workflowMessage,this.snackbar=!0}}},Z=y,T=s(1001),_=(0,T.Z)(Z,v,g,!1,null,null,null),w=_.exports,D=s(8345),x=s(7263),C=s(9582),R=s(4886),I=s(266),q=s(1713),A=function(){var e=this,t=e._self._c;return t(q.Z,{attrs:{justify:"center"}},[t(I.Z,{attrs:{cols:"12",sm:"12",md:"4"}},[t(C.Z,{attrs:{height:"200px"}},[t(R.EB,{staticClass:"justify-center",attrs:{"mb-3":""}},[t("h1",{staticClass:"display-1"},[e._v("ログイン")])]),t(R.h7,{staticClass:"justify-center"},[t(n.Z,{staticStyle:{"text-transform":"none"},attrs:{width:"80%"},on:{click:e.loginWithGoogle}},[t("svg",{staticClass:"mr-3",attrs:{width:"18",height:"18",viewBox:"0 0 18 18"}},[t("path",{attrs:{d:"M16.51 8H8.98v3h4.3c-.18 1-.74 1.48-1.6 2.04v2.01h2.6a7.8 7.8 0 002.38-5.88c0-.57-.05-.66-.15-1.18z",fill:"#4285F4"}}),t("path",{attrs:{d:"M8.98 17c2.16 0 3.97-.72 5.3-1.94l-2.6-2a4.8 4.8 0 01-7.18-2.54H1.83v2.07A8 8 0 008.98 17z",fill:"#34A853"}}),t("path",{attrs:{d:"M4.5 10.52a4.8 4.8 0 010-3.04V5.41H1.83a8 8 0 000 7.18l2.67-2.07z",fill:"#FBBC05"}}),t("path",{attrs:{d:"M8.98 4.18c1.17 0 2.23.4 3.06 1.2l2.3-2.3A8 8 0 001.83 5.4L4.5 7.49a4.77 4.77 0 014.48-3.3z",fill:"#EA4335"}})]),e._v(" Login with Google ")])],1)],1)],1)],1)},N=[],U={name:"Login",data(){return{redirect:null}},methods:{async loginWithGoogle(){this.redirect=this.$route.query.redirect,await this.$store.dispatch("firebase/login"),this.redirect?this.$router.push(this.redirect):this.$router.push("/")}}},E=U,$=(0,T.Z)(E,A,N,!1,null,null,null),S=$.exports,P=s(5125),O=s(7808),B=function(){var e=this,t=e._self._c;return t("div",{staticClass:"form-wrapper"},[t("p",[e._v("※設定はこのデバイスのみに保存されます。")]),t(P.Z,{model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[t("h3",[e._v("アプリ設定")]),t(O.Z,{attrs:{label:"アプリ名",counter:30,rules:[e.appNameRule]},model:{value:e.settings.appName,callback:function(t){e.$set(e.settings,"appName",t)},expression:"settings.appName"}}),t(O.Z,{attrs:{label:"API URL",counter:150,rules:[e.stringRule]},model:{value:e.settings.apiUrl,callback:function(t){e.$set(e.settings,"apiUrl",t)},expression:"settings.apiUrl"}}),t(O.Z,{attrs:{label:"Auth Token",counter:150,rules:[e.stringRule]},model:{value:e.settings.authToken,callback:function(t){e.$set(e.settings,"authToken",t)},expression:"settings.authToken"}}),t(q.Z,{staticClass:"mt-4"},[t(f.Z),t(n.Z,{attrs:{color:"primary",disabled:!e.valid},on:{click:e.onClickSave}},[e._v("保存")])],1)],1)],1)},M=[],j={name:"Settings",data(){return{settings:{...this.$store.state.workflow.settings},valid:!1,appNameRule:e=>e.length<=30||"30文字以内で入力してください",stringRule:e=>e.length<=150||"150文字以内で入力してください"}},methods:{onClickSave(){this.$store.dispatch("workflow/saveSettings",{settings:this.settings})}}},H=j,J=(0,T.Z)(H,B,M,!1,null,null,null),F=J.exports,W=s(1154),L=s(4127),V=s(3863),Y=s(4324),Q=s(626),z=s(2769),G=function(){var e=this,t=e._self._c;return t("div",[t(q.Z,[t(I.Z,{attrs:{cols:"12",md:"6",xs:"12"}},[t(z.Z,{attrs:{grow:"",color:"green"}},[t(Q.Z,{on:{click:function(t){return e.onClickTab("myRequests")}}},[e._v("自分の申請")]),t(Q.Z,{on:{click:function(t){return e.onClickTab("othersRequests")}}},[e.numberOfOthersRequests?[t(W.Z,{attrs:{color:"red",content:e.numberOfOthersRequests}},[e._v("承認依頼")])]:[e._v("承認依頼")]],2)],1)],1)],1),t(C.Z,[t(R.EB,[t(I.Z,{attrs:{cols:"8"}},[t("div",{staticClass:"h5"},[e._v(" "+e._s(e.title)+" ")])]),t(f.Z),t(I.Z,{staticClass:"text-right",attrs:{cols:"4"}},[t(n.Z,{attrs:{dark:"",color:"green"},on:{click:e.onClickAdd}},[t(Y.Z,[e._v("mdi-plus")])],1)],1),t(I.Z,{attrs:{cols:"12"}},[t(O.Z,{attrs:{"append-icon":"mdi-magnify",label:"Search","single-line":"","hide-details":""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1)],1),t(V.Z,{staticClass:"text-no-wrap",attrs:{headers:e.tableHeaders,items:e.formattedTableData,search:e.search,"footer-props":e.footerProps,"sort-by":"created_at","sort-desc":!0,"items-per-page":30,"mobile-breakpoint":"0"},on:{"click:row":e.onClickRow},scopedSlots:e._u([{key:"item.status",fn:function({item:s}){return[t(L.Z,{staticClass:"ma-2",attrs:{color:e.statusColor(s),"text-color":"white"}},[t(Y.Z,{attrs:{left:""}},[e._v(" "+e._s(e.statusIcon(s))+" ")]),e._v(" "+e._s(s.status)+" ")],1)]}}],null,!0)})],1),t("ItemDialogRequestOverview",{ref:"ItemDialogRequestOverview"})],1)},K=[],X=s(9930),ee=s(9223),te=s(9481),se=s(2648),ae=function(){var e=this,t=e._self._c;return t(X.Z,{attrs:{scrollable:"",persistent:"","max-width":"500px",eager:""},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[t(C.Z,[t(R.EB,[e._v(e._s(e.titleText))]),t(ee.Z),t(R.ZB,[t(P.Z,{ref:"form",model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[t(te.Z,{attrs:{label:"申請種別",items:e.items,rules:e.requestTypeRules},model:{value:e.requestType,callback:function(t){e.requestType=t},expression:"requestType"}}),t(O.Z,{attrs:{label:"タイトル",rules:e.titleRules},model:{value:e.title,callback:function(t){e.title=t},expression:"title"}}),"paid_leave"==e.requestType?t("div",[t(se.Z,{attrs:{label:"事由",rules:e.reasonRules,rows:"3"},model:{value:e.reason,callback:function(t){e.reason=t},expression:"reason"}}),t(se.Z,{attrs:{label:"予定日時",rules:e.dateRules,rows:"3"},model:{value:e.date,callback:function(t){e.date=t},expression:"date"}}),t(O.Z,{attrs:{label:"緊急連絡先",rules:e.contactRules},model:{value:e.contact,callback:function(t){e.contact=t},expression:"contact"}}),t(se.Z,{attrs:{label:"備考",rows:"3"},model:{value:e.memo,callback:function(t){e.memo=t},expression:"memo"}})],1):e._e()],1)],1),t(ee.Z),t(R.h7,[t(f.Z),t(n.Z,{attrs:{color:"grey darken-1",text:""},on:{click:e.onClickClose}},[e._v(" キャンセル ")]),t(n.Z,{attrs:{color:"blue darken-1",text:"",disabled:!e.valid},on:{click:e.onClickAction}},[e._v(" "+e._s(e.actionText)+" ")])],1)],1)],1)},re=[],ie=s(1294),oe=s(7632),ne={name:"ItemDialogRequestOverview",data(){return{items:[{text:"休暇申請",value:"paid_leave"},{text:"備品申請",value:"equipment"}],show:!1,valid:!1,menu:!1,actionType:"add",requestType:"",id:"",title:"",reason:"",date:"",contact:"",memo:"",requestTypeRules:[e=>e.trim().length>0||"申請種別は必須です"],titleRules:[e=>e.trim().length>0||"タイトルは必須です"],reasonRules:[e=>e.trim().length>0||"事由は必須です"],dateRules:[e=>e.trim().length>0||"予定日時は必須です"],contactRules:[e=>e.trim().length>0||"緊急連絡先は必須です"]}},computed:{...(0,k.rn)({userInfo:e=>e.firestore.userInfo}),titleText(){return"add"===this.actionType?"データ追加":"データ編集"},actionText(){return"add"===this.actionType?"追加":"更新"}},methods:{...(0,k.Se)({getUserEmail:"firebase/getUserEmail",getArrayRoute:"firestore/getArrayRoute"}),...(0,k.nv)({batchAddSubCollectionsToUsers:"firestore/batchAddSubCollectionsToUsers",fetchUserInfo:"firestore/fetchUserInfo",createArrayRoute:"firestore/createArrayRoute",sendEmail:"firestore/sendEmail"}),open(e,t){this.show=!0,this.actionType=e,this.resetForm(t)},onClickClose(){this.show=!1},async onClickAction(){if("add"===this.actionType){const e=(0,oe.Z)(),t=this.getUserEmail(),s=this.requestType,a=e=>{switch(e){case"paid_leave":return"休暇申請";case"equipment":return"備品申請"}},r=a(s);console.log("requestTypeValue:"),console.log(s),console.log("requestTypeText:"),console.log(r),await this.fetchUserInfo({userId:t});const i=this.userInfo.department;await this.createArrayRoute({requestTypeValue:s,department:i});const o=this.getArrayRoute()[0],n=[];o.approvers.forEach((e=>{n.push({...e,status:"保留中"})})),o.approvers=n;const l=1,c=o.approvers.length,u={request:{request_type:r,title:this.title,status:"保留中",current_approver_email:o.approvers[0].email,created_at:(0,ie.Bt)(),email:this.userInfo.id,name:this.userInfo.name,department:this.userInfo.department},detail:{id:e,title:this.title,status:"保留中",current_approver_email:o.approvers[0].email,created_at:(0,ie.Bt)(),email:this.userInfo.id,name:this.userInfo.name,department:this.userInfo.department,current_step:l,max_step:c,reason:this.reason,date:this.date,contact:this.contact,memo:this.memo,routes:o,comments:[]}};await this.batchAddSubCollectionsToUsers({uid:e,userId:t,item:u});const d=o.approvers[0].email,m=`[承認依頼] [${this.title}]`,h=`${window.location.href}others/requests/${e}`,p=this.createEmailBody(m,h),f={to:d,subject:m,body:p};await this.sendEmail({emailConfig:f}),this.show=!1}},resetForm(e={}){this.id=e.id||"",this.title=e.title||"",this.reason=e.reason||"",this.date=e.date||"",this.contact=e.contact||"",this.memo=e.memo||"",this.$refs.form.resetValidation()},createEmailBody(e,t){const s=`${e}<br><br>詳細は下記リンクからご確認ください。<br><br><a href="${t}">${t}</a>`;return s}}},le=ne,ce=(0,T.Z)(le,ae,re,!1,null,null,null),ue=ce.exports,de={name:"RequestOverView",components:{ItemDialogRequestOverview:ue},data(){return{currentTableName:"myRequests",title:"申請一覧",search:"",tableData:[]}},computed:{...(0,k.rn)({myRequests:e=>e.firestore.myRequests,othersRequests:e=>e.firestore.othersRequests,selectedTabName:e=>e.firestore.selectedTabName}),formattedTableData(){return this.tableData.map((e=>({...e,created_at:this.dateToStr24HPad0(e.created_at.toDate())})))},tableHeaders(){return[{text:"作成日時",value:"created_at"},{text:"申請種別",value:"request_type",sortable:!1},{text:"ステータス",value:"status",sortable:!1},{text:"タイトル",value:"title",sortable:!1},{text:"申請者",value:"name",sortable:!1},{text:"部署",value:"department",sortable:!1}]},footerProps(){return{itemsPerPageText:"",itemsPerPageOptions:[30,-1]}},numberOfOthersRequests(){return this.othersRequests.length}},methods:{...(0,k.nv)({fetchMyRequests:"firestore/fetchMyRequests",fetchOthersRequests:"firestore/fetchOthersRequests",setSelectedTabName:"firestore/setSelectedTabName"}),...(0,k.Se)({getUserEmail:"firebase/getUserEmail"}),onClickAdd(){this.$refs.ItemDialogRequestOverview.open("add")},onClickRow(e){switch(this.selectedTabName){case"myRequests":this.$router.push({path:`/my/requests/${e.id}`});break;case"othersRequests":this.$router.push({path:`/others/requests/${e.id}`});break}},async onClickTab(e){this.setSelectedTabName({selectedTabName:e});const t=this.getUserEmail();switch(e){case"myRequests":await this.fetchMyRequests({userId:t}),this.tableData=this.myRequests;break;case"othersRequests":this.tableData=this.othersRequests;break}},dateToStr24HPad0(e,t){return t||(t="YYYY/MM/DD hh:mm"),t=t.replace(/YYYY/g,e.getFullYear()),t=t.replace(/MM/g,("0"+(e.getMonth()+1)).slice(-2)),t=t.replace(/DD/g,("0"+e.getDate()).slice(-2)),t=t.replace(/hh/g,("0"+e.getHours()).slice(-2)),t=t.replace(/mm/g,("0"+e.getMinutes()).slice(-2)),t=t.replace(/ss/g,("0"+e.getSeconds()).slice(-2)),t},statusColor(e){let t="";switch(e.status){case"完了":t="green";break;case"保留中":t="blue";break;case"否認":t="red";break;case"差戻し":t="orange";break}return t},statusIcon(e){let t="";switch(e.status){case"完了":t="mdi-check";break;case"保留中":t="mdi-timer-sand";break;case"否認":t="mdi-cancel";break;case"差戻し":t="mdi-arrow-u-left-bottom";break}return t}},async created(){this.setSelectedTabName({selectedTabName:"myRequests"});const e=this.getUserEmail();await this.fetchMyRequests({userId:e}),await this.fetchOthersRequests({userId:e}),this.tableData=this.myRequests}},me=de,he=(0,T.Z)(me,G,K,!1,null,null,null),pe=he.exports,fe=s(8271),be=s(535),ve=s(1744),ge=s(8491),ke=function(){var e=this,t=e._self._c;return t("div",[t(q.Z,{attrs:{justify:"center"}},[t(I.Z,{attrs:{cols:"12",md:"6",xs:"12"}},[t(C.Z,[e.$vuetify.breakpoint.xs||e.$vuetify.breakpoint.sm?[e.data.current_step?t(be.Z,{attrs:{vertical:""},model:{value:e.data.current_step,callback:function(t){e.$set(e.data,"current_step",t)},expression:"data.current_step"}},[e._l(e.data.max_step,(function(s,a){return[t(ge.Z,{key:`${s}-step`,attrs:{complete:"完了"==e.data.routes.approvers[a].status,step:s,rules:[()=>{const t=["否認"==e.data.routes.approvers[a].status,"差戻し"==e.data.routes.approvers[a].status];return!t.some((e=>1==e))}]}},[e._v(" "+e._s(e.data.routes.approvers[a].name)+" "),t("small",{staticClass:"mt-2"},[e._v(e._s(e.data.routes.approvers[a].status))])]),s<e.data.max_step?t("div",{key:`${s}-div`,staticStyle:{"border-left":"1px solid rgba(0,0,0,.25)",height:"30px","margin-left":"36px"}}):e._e()]}))],2):e._e()]:[e.data.current_step?t(be.Z,{attrs:{"alt-labels":""},model:{value:e.data.current_step,callback:function(t){e.$set(e.data,"current_step",t)},expression:"data.current_step"}},[t(ve.Rp,[e._l(e.data.max_step,(function(s,a){return[t(ge.Z,{key:`${s}-step`,attrs:{complete:"完了"==e.data.routes.approvers[a].status,step:s,rules:[()=>{const t=["否認"==e.data.routes.approvers[a].status,"差戻し"==e.data.routes.approvers[a].status];return!t.some((e=>1==e))}]}},[e._v(" "+e._s(e.data.routes.approvers[a].name)+" "),t("small",{staticClass:"mt-2"},[e._v(e._s(e.data.routes.approvers[a].status))])]),s<e.data.max_step?t(ee.Z,{key:`${s}-divider`}):e._e()]}))],2)],1):e._e()]],2)],1)],1),t(q.Z,{attrs:{justify:"center"}},[t(I.Z,{attrs:{cols:"12",md:"6",xs:"12"}},[t(C.Z,[t(R.ZB,[t(P.Z,{attrs:{readonly:""}},[t(O.Z,{attrs:{label:"タイトル"},model:{value:e.data.title,callback:function(t){e.$set(e.data,"title",t)},expression:"data.title"}}),t(O.Z,{attrs:{label:"作成日時"},model:{value:e.formattedDate,callback:function(t){e.formattedDate=t},expression:"formattedDate"}}),t(O.Z,{attrs:{label:"申請者"},model:{value:e.data.name,callback:function(t){e.$set(e.data,"name",t)},expression:"data.name"}}),t(O.Z,{attrs:{label:"メールアドレス"},model:{value:e.data.email,callback:function(t){e.$set(e.data,"email",t)},expression:"data.email"}}),t(O.Z,{attrs:{label:"部署"},model:{value:e.data.department,callback:function(t){e.$set(e.data,"department",t)},expression:"data.department"}}),t(O.Z,{attrs:{label:"事由"},model:{value:e.data.reason,callback:function(t){e.$set(e.data,"reason",t)},expression:"data.reason"}}),t(O.Z,{attrs:{label:"予定日時"},model:{value:e.data.date,callback:function(t){e.$set(e.data,"date",t)},expression:"data.date"}}),t(O.Z,{attrs:{label:"緊急連絡先"},model:{value:e.data.contact,callback:function(t){e.$set(e.data,"contact",t)},expression:"data.contact"}}),t(O.Z,{attrs:{label:"備考"},model:{value:e.data.memo,callback:function(t){e.$set(e.data,"memo",t)},expression:"data.memo"}})],1)],1)],1)],1)],1),t(fe.Z,{attrs:{app:"",padless:""}},[t(I.Z,{staticClass:"text-center",attrs:{col:"12"}},[t(n.Z,{staticClass:"mx-2",attrs:{color:"green",dark:!e.isDisabledApproveBtn,disabled:e.isDisabledApproveBtn},on:{click:e.onClickApprove}},[e._v("承認")]),t(n.Z,{staticClass:"mx-2",attrs:{color:"green",dark:!e.isDisabledApproveBtn,disabled:e.isDisabledApproveBtn},on:{click:e.onClickDisapprove}},[e._v("否認")]),t(n.Z,{staticClass:"mx-2",attrs:{color:"green",dark:!e.isDisabledApproveBtn,disabled:e.isDisabledApproveBtn},on:{click:e.onClickRemand}},[e._v("差戻し")]),t(n.Z,{staticClass:"mx-2",attrs:{color:"green",dark:!e.isDisabledEditBtn,disabled:e.isDisabledEditBtn},on:{click:e.onClickEdit}},[e._v("編集")])],1)],1),t("ItemDialogRequestDetail",{ref:"ItemDialogRequestDetail"})],1)},ye=[],Ze=function(){var e=this,t=e._self._c;return t(X.Z,{attrs:{scrollable:"",persistent:"","max-width":"500px",eager:""},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[t(C.Z,[t(R.EB,[e._v(e._s(e.titleText))]),t(ee.Z),t(R.ZB,[t(P.Z,{ref:"form",model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[t(O.Z,{attrs:{label:"タイトル",rules:e.titleRules},model:{value:e.title,callback:function(t){e.title=t},expression:"title"}}),"paid_leave"==e.requestType?t("div",[t(se.Z,{attrs:{label:"事由",rules:e.reasonRules,rows:"3"},model:{value:e.reason,callback:function(t){e.reason=t},expression:"reason"}}),t(se.Z,{attrs:{label:"予定日時",rules:e.dateRules,rows:"3"},model:{value:e.date,callback:function(t){e.date=t},expression:"date"}}),t(O.Z,{attrs:{label:"緊急連絡先",rules:e.contactRules},model:{value:e.contact,callback:function(t){e.contact=t},expression:"contact"}}),t(se.Z,{attrs:{label:"備考",rows:"3"},model:{value:e.memo,callback:function(t){e.memo=t},expression:"memo"}})],1):e._e()],1)],1),t(ee.Z),t(R.h7,[t(f.Z),t(n.Z,{attrs:{color:"grey darken-1",text:""},on:{click:e.onClickClose}},[e._v(" キャンセル ")]),t(n.Z,{attrs:{color:"blue darken-1",text:"",disabled:!e.valid},on:{click:e.onClickAction}},[e._v(" "+e._s(e.actionText)+" ")])],1)],1)],1)},Te=[],_e={name:"ItemDialogRequestDetail",data(){return{requestType:"",show:!1,valid:!1,menu:!1,actionType:"edit",item:{},id:"",title:"",reason:"",date:"",contact:"",memo:"",titleRules:[e=>e.trim().length>0||"タイトルは必須です"],reasonRules:[e=>e.trim().length>0||"事由は必須です"],dateRules:[e=>e.trim().length>0||"予定日時は必須です"],contactRules:[e=>e.trim().length>0||"緊急連絡先は必須です"]}},computed:{...(0,k.rn)({userInfo:e=>e.firestore.userInfo}),titleText(){return"add"===this.actionType?"データ追加":"データ編集"},actionText(){return"add"===this.actionType?"追加":"更新"}},methods:{...(0,k.Se)({getUserEmail:"firebase/getUserEmail",getArrayRoute:"firestore/getArrayRoute"}),...(0,k.nv)({batchAddSubCollectionsToUsers:"firestore/batchAddSubCollectionsToUsers",fetchUserInfo:"firestore/fetchUserInfo",createArrayRoute:"firestore/createArrayRoute",sendEmail:"firestore/sendEmail",batchUpdateDocuments:"firestore/batchUpdateDocuments"}),open(e,t,s){this.item=t,console.log("this.item:"),console.log(this.item),this.show=!0,this.actionType=e,this.requestType=s,this.resetForm(t)},onClickClose(){this.show=!1},async onClickAction(){if("edit"===this.actionType){this.item.itemRequest.current_approver_email=this.item.itemDetail.routes.approvers[0].email,this.item.itemDetail.current_approver_email=this.item.itemDetail.routes.approvers[0].email,this.item.itemRequest.status="保留中",this.item.itemDetail.status="保留中",this.item.itemDetail.current_step=1,this.item.itemDetail.routes.approvers.map((e=>e.status="保留中")),this.item.itemRequest={...this.item.itemRequest,title:this.title},this.item.itemDetail={...this.item.itemDetail,title:this.title,reason:this.reason,date:this.date,contact:this.contact,memo:this.memo};const e=this.item.itemRequest.email,t=this.$route.params.id,s=this.item.itemRequest,a=this.item.itemDetail,r="再提出";this.batchUpdateDocuments({userId:e,docId:t,itemRequest:s,itemDetail:a,operationType:r});const i=this.item.itemDetail.routes.approvers[0].email,o=`申請が再提出されました [${this.title}]`,n=window.location.href,l=n.replace("/my","/others"),c=this.createEmailBody(o,l),u={to:i,subject:o,body:c};await this.sendEmail({emailConfig:u}),this.show=!1}},resetForm(e={}){this.id=e.id||"",this.title=e.title||"",this.reason=e.reason||"",this.date=e.date||"",this.contact=e.contact||"",this.memo=e.memo||"",this.$refs.form.resetValidation()},createEmailBody(e,t){const s=`${e}<br><br>詳細は下記リンクからご確認ください。<br><br><a href="${t}">${t}</a>`;return s}}},we=_e,De=(0,T.Z)(we,Ze,Te,!1,null,null,null),xe=De.exports,Ce={name:"RequestDetail",components:{ItemDialogRequestDetail:xe},data(){return{currentTableName:"details",latestStatus:"",latestApproverEmail:""}},computed:{...(0,k.rn)({requests:e=>e.firestore.requests,details:e=>e.firestore.details,selectedTabName:e=>e.firestore.selectedTabName}),...(0,k.Se)({getUserEmail:"firebase/getUserEmail"}),data(){return this.details},formattedDate(){if(""==this.data)return!1;{const e=this.data.created_at.toDate();return this.dateToStr24HPad0(e)}},isDisabledApproveBtn(){if(this.data.current_step){const e=[this.data.routes.approvers[this.data.current_step-1].email!=this.getUserEmail,"完了"==this.data.routes.approvers[this.data.max_step-1].status,"否認"==this.data.routes.approvers[this.data.current_step-1].status,"差戻し"==this.data.routes.approvers[this.data.current_step-1].status];return e.some((e=>1==e))}return!0},isDisabledEditBtn(){const e=[this.data.email!=this.getUserEmail,"保留中"==this.data.status,"完了"==this.data.status,"否認"==this.data.status];return e.some((e=>1==e))}},methods:{...(0,k.nv)({fetchCollectionsByOneQuery:"firestore/fetchCollectionsByOneQuery",fetchMyDetail:"firestore/fetchMyDetail",fetchOthersDetail:"firestore/fetchOthersDetail",fetchRequest:"firestore/fetchRequest",batchUpdateDocuments:"firestore/batchUpdateDocuments",sendEmail:"firestore/sendEmail"}),async fetchRequestDetail(){const e=this.$route.path,t=this.getUserEmail,s=this.$route.params.id;e.startsWith("/my/")?await this.fetchMyDetail({userId:t,docId:s}):e.startsWith("/others/")&&await this.fetchOthersDetail({userId:t,docId:s})},dateToStr24HPad0(e,t){return t||(t="YYYY/MM/DD hh:mm"),t=t.replace(/YYYY/g,e.getFullYear()),t=t.replace(/MM/g,("0"+(e.getMonth()+1)).slice(-2)),t=t.replace(/DD/g,("0"+e.getDate()).slice(-2)),t=t.replace(/hh/g,("0"+e.getHours()).slice(-2)),t=t.replace(/mm/g,("0"+e.getMinutes()).slice(-2)),t=t.replace(/ss/g,("0"+e.getSeconds()).slice(-2)),t},setData(){},async onClickApprove(){const e="承認";if(this.data.current_step==this.data.max_step){this.data.routes.approvers[this.data.current_step-1].status="完了",this.latestStatus=this.data.routes.approvers[this.data.current_step-1].status,this.latestApproverEmail="",this.batchUpdate(e);const t=this.data.email,s=`申請が${e}されました [${this.data.title}]`,a=window.location.href,r=a.replace("/others","/my"),i=this.createEmailBody(s,r),o={to:t,subject:s,body:i};await this.sendEmail({emailConfig:o})}else{this.data.routes.approvers[this.data.current_step-1].status="完了",this.data.current_step++,this.latestStatus="保留中",this.latestApproverEmail=this.data.routes.approvers[this.data.current_step-1].email,this.batchUpdate(e);const t=this.latestApproverEmail,s=`[承認依頼] [${this.data.title}]`,a=window.location.href,r=this.createEmailBody(s,a),i={to:t,subject:s,body:r};await this.sendEmail({emailConfig:i})}},async onClickDisapprove(){this.data.routes.approvers[this.data.current_step-1].status="否認",this.latestStatus="否認",this.latestApproverEmail="";const e="否認";this.batchUpdate(e);const t=this.data.email,s=`申請が${e}されました [${this.data.title}]`,a=window.location.href,r=a.replace("/others","/my"),i=this.createEmailBody(s,r),o={to:t,subject:s,body:i};await this.sendEmail({emailConfig:o})},async onClickRemand(){this.data.routes.approvers[this.data.current_step-1].status="差戻し",this.latestStatus="差戻し",this.latestApproverEmail="";const e="差戻し";this.batchUpdate(e);const t=this.data.email,s=`申請が${e}されました [${this.data.title}]`,a=window.location.href,r=a.replace("/others","/my"),i=this.createEmailBody(s,r),o={to:t,subject:s,body:i};await this.sendEmail({emailConfig:o})},async batchUpdate(e){const t=this.data.email,s=this.$route.params.id;await this.fetchRequest({userId:t,docId:s});const a=this.requests,r=this.data;r.current_step=this.data.current_step,a.status=this.latestStatus,r.status=this.latestStatus,a.current_approver_email=this.latestApproverEmail,this.batchUpdateDocuments({userId:t,docId:s,itemRequest:a,itemDetail:r,operationType:e})},createEmailBody(e,t){const s=`${e}<br><br>詳細は下記リンクからご確認ください。<br><br><a href="${t}">${t}</a>`;return s},async onClickEdit(){const e=this.data.email,t=this.$route.params.id;await this.fetchRequest({userId:e,docId:t});const s=this.requests,a=this.data,r="paid_leave",i={title:this.data.title,reason:this.data.reason,date:this.data.date,contact:this.data.contact,memo:this.data.memo,itemRequest:s,itemDetail:a};await this.$refs.ItemDialogRequestDetail.open("edit",i,r)}},async created(){await this.fetchRequestDetail(),this.setData()}},Re=Ce,Ie=(0,T.Z)(Re,ke,ye,!1,null,null,null),qe=Ie.exports,Ae=function(){var e=this,t=e._self._c;return t("div",[t(C.Z,[t(R.EB,[t(I.Z,{attrs:{cols:"8"}},[t("div",{staticClass:"h5"},[e._v(" "+e._s(e.title)+" ")])]),t(f.Z),t(I.Z,{staticClass:"text-right",attrs:{cols:"4"}},[t(n.Z,{attrs:{dark:"",color:"green"},on:{click:e.onClickAdd}},[t(Y.Z,[e._v("mdi-plus")])],1)],1),t(I.Z,{attrs:{cols:"12"}},[t(O.Z,{attrs:{"append-icon":"mdi-magnify",label:"Search","single-line":"","hide-details":""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1)],1),t(V.Z,{staticClass:"text-no-wrap",attrs:{headers:e.tableHeaders,items:e.tableData,search:e.search,"footer-props":e.footerProps,"sort-by":"department","sort-desc":!1,"items-per-page":30,"mobile-breakpoint":"0"},scopedSlots:e._u([{key:"item.actions",fn:function({item:s}){return[t(Y.Z,{staticClass:"mr-2",on:{click:function(t){return e.onClickEdit(s)}}},[e._v("mdi-pencil")]),t(Y.Z,{on:{click:function(t){return e.onClickDelete(s)}}},[e._v("mdi-delete")])]}}],null,!0)})],1),t("ItemDialogDepartments",{ref:"ItemDialogDepartments"}),t("DeleteDialog",{ref:"deleteDialog"})],1)},Ne=[],Ue=function(){var e=this,t=e._self._c;return t(X.Z,{attrs:{scrollable:"",persistent:"","max-width":"500px",eager:""},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[t(C.Z,[t(R.EB,[e._v(e._s(e.titleText))]),t(ee.Z),t(R.ZB,[t(P.Z,{ref:"form",model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[t(O.Z,{attrs:{label:"部署",rules:e.departmentRules},model:{value:e.department,callback:function(t){e.department=t},expression:"department"}})],1)],1),t(ee.Z),t(R.h7,[t(f.Z),t(n.Z,{attrs:{color:"grey darken-1",text:""},on:{click:e.onClickClose}},[e._v(" キャンセル ")]),t(n.Z,{attrs:{color:"blue darken-1",text:"",disabled:!e.valid},on:{click:e.onClickAction}},[e._v(" "+e._s(e.actionText)+" ")])],1)],1)],1)},Ee=[],$e={name:"ItemDialogDepartments",data(){return{currentTableName:"departments",show:!1,valid:!1,menu:!1,actionType:"add",id:"",department:"",departmentRules:[e=>e.trim().length>0||"部署は必須です",e=>e.length<=32||"32文字以内で入力してください"]}},computed:{titleText(){return"add"===this.actionType?"データ追加":"データ編集"},actionText(){return"add"===this.actionType?"追加":"更新"}},methods:{...(0,k.nv)({addDocument:"firestore/addDocument",updateDocument:"firestore/updateDocument"}),open(e,t){this.show=!0,this.actionType=e,this.resetForm(t)},onClickClose(){this.show=!1},async onClickAction(){const e={id:this.id,department:this.department},t=this.currentTableName;"add"===this.actionType?await this.addDocument({item:e,currentTableName:t}):await this.updateDocument({item:e,currentTableName:t}),this.show=!1},resetForm(e={}){this.id=e.id||"",this.department=e.department||"",this.$refs.form.resetValidation()}}},Se=$e,Pe=(0,T.Z)(Se,Ue,Ee,!1,null,null,null),Oe=Pe.exports,Be=function(){var e=this,t=e._self._c;return t(X.Z,{attrs:{persistent:"","max-width":"290"},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[t(C.Z,[t(R.EB),t(R.ZB,{staticClass:"black--text"},[e._v(" 削除しますか？ ")]),t(R.h7,[t(f.Z),t(n.Z,{attrs:{color:"grey",text:""},on:{click:e.onClickClose}},[e._v("キャンセル")]),t(n.Z,{attrs:{color:"red",text:""},on:{click:e.onClickDelete}},[e._v("削除")])],1)],1)],1)},Me=[],je={name:"DeleteDialog",data(){return{show:!1,item:{},currentTableName:""}},methods:{...(0,k.nv)({deleteDocument:"firestore/deleteDocument"}),open(e,t){this.show=!0,this.item=e,this.currentTableName=t},onClickClose(){this.show=!1},async onClickDelete(){const e=this.item,t=this.currentTableName;await this.deleteDocument({item:e,currentTableName:t}),this.show=!1}}},He=je,Je=(0,T.Z)(He,Be,Me,!1,null,null,null),Fe=Je.exports,We={name:"Departments",components:{ItemDialogDepartments:Oe,DeleteDialog:Fe},data(){return{currentTableName:"departments",title:"部署一覧",search:"",tableData:[]}},computed:{...(0,k.rn)({departments:e=>e.firestore.departments}),tableHeaders(){return[{text:"部署",value:"department",sortable:!0},{text:"操作",value:"actions",sortable:!1}]},footerProps(){return{itemsPerPageText:"",itemsPerPageOptions:[30,-1]}}},methods:{...(0,k.nv)({fetchAllCollections:"firestore/fetchAllCollections"}),onClickAdd(){this.$refs.ItemDialogDepartments.open("add")},onClickEdit(e){this.$refs.ItemDialogDepartments.open("edit",e)},onClickDelete(e){const t=this.currentTableName;this.$refs.deleteDialog.open(e,t)},async getRecords(){const e=this.currentTableName;await this.fetchAllCollections({currentTableName:e}),this.tableData=this.departments}},async created(){await this.getRecords()}},Le=We,Ve=(0,T.Z)(Le,Ae,Ne,!1,null,null,null),Ye=Ve.exports,Qe=function(){var e=this,t=e._self._c;return t(C.Z,[t(z.Z,{attrs:{grow:"",color:"green"}},[t(Q.Z,{on:{click:function(t){return e.onClickTab("paid_leave")}}},[e._v("休暇申請")]),t(Q.Z,{on:{click:function(t){return e.onClickTab("equipment")}}},[e._v("備品申請")])],1),t(R.EB,[t(I.Z,{attrs:{cols:"8"}},[t("div",{staticClass:"h5"},[e._v(" "+e._s(e.title)+" ")])]),t(f.Z),t(I.Z,{staticClass:"text-right",attrs:{cols:"4"}},[t(n.Z,{attrs:{dark:"",color:"green"},on:{click:e.onClickAdd}},[t(Y.Z,[e._v("mdi-plus")])],1)],1),t(I.Z,{attrs:{cols:"12"}},[t(O.Z,{attrs:{"append-icon":"mdi-magnify",label:"Search","single-line":"","hide-details":"",clearable:""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1)],1),t(V.Z,{staticClass:"text-no-wrap",attrs:{headers:e.tableHeaders,items:e.tableData,search:e.search,"footer-props":e.footerProps,"sort-by":["department","order"],"sort-desc":[!1,!1],"items-per-page":30,"mobile-breakpoint":"0"},scopedSlots:e._u([{key:"item.actions",fn:function({item:s}){return[t(Y.Z,{staticClass:"mr-2",on:{click:function(t){return e.onClickEdit(s)}}},[e._v("mdi-pencil")]),t(Y.Z,{on:{click:function(t){return e.onClickDelete(s)}}},[e._v("mdi-delete")])]}}],null,!0)}),t("ItemDialogRoutes",{ref:"ItemDialogRoutes"}),t("DeleteDialog",{ref:"deleteDialog"})],1)},ze=[],Ge=function(){var e=this,t=e._self._c;return t(X.Z,{attrs:{scrollable:"",persistent:"","max-width":"700px",eager:""},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[t(C.Z,[t(R.EB,[e._v(e._s(e.titleText))]),t(ee.Z),t(R.ZB,[t(P.Z,{ref:"form",model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[t(te.Z,{attrs:{label:"部署",rules:e.departmentRules,items:e.departments,"item-text":"department","item-value":"department"},model:{value:e.department,callback:function(t){e.department=t},expression:"department"}}),t(O.Z,{attrs:{label:"タイトル",rules:e.titleRules},model:{value:e.title,callback:function(t){e.title=t},expression:"title"}}),t(O.Z,{attrs:{label:"承認者数",rules:e.numberOfApproversRules,readonly:""},model:{value:e.approvers.length,callback:function(t){e.$set(e.approvers,"length",t)},expression:"approvers.length"}}),t(V.Z,{staticClass:"text-no-wrap",attrs:{headers:e.tableHeaders,items:e.approvers,"footer-props":e.footerProps,"sort-by":["order"],"sort-desc":[!1],"items-per-page":30,"mobile-breakpoint":"0","hide-default-footer":""},scopedSlots:e._u([{key:"item.actions",fn:function({item:s}){return[t(Y.Z,{on:{click:function(t){return e.deleteApprover(s)}}},[e._v("mdi-delete")])]}}],null,!0)}),t(te.Z,{attrs:{label:"承認者",items:e.users,"item-text":e=>`${e.name} (${e.id})`,"return-object":""},model:{value:e.userInfo,callback:function(t){e.userInfo=t},expression:"userInfo"}}),t(f.Z),t(n.Z,{attrs:{color:"blue darken-1",text:"",disabled:!e.userInfo.id},on:{click:e.addApprover}},[e._v("追加")])],1)],1),t(ee.Z),t(R.h7,[t(f.Z),t(n.Z,{attrs:{color:"grey darken-1",text:""},on:{click:e.onClickClose}},[e._v(" キャンセル ")]),t(n.Z,{attrs:{color:"blue darken-1",text:"",disabled:!e.valid},on:{click:e.onClickAction}},[e._v(" "+e._s(e.actionText)+" ")])],1)],1)],1)},Ke=[],Xe={name:"ItemDialogRoutes",data(){return{currentTableName:"routes",currentTabName:"",show:!1,valid:!1,menu:!1,actionType:"add",id:"",department:"",title:"",userInfo:"",numberOfApprovers:"",approvers:[],readers:[],departmentRules:[e=>e.trim().length>0||"部署は必須です"],titleRules:[e=>e.trim().length>0||"タイトルは必須です"],numberOfApproversRules:[e=>e>0||"承認者は必須です"]}},computed:{...(0,k.rn)({departments:e=>e.firestore.departments,users:e=>e.firestore.users}),titleText(){return"add"===this.actionType?"データ追加":"データ編集"},actionText(){return"add"===this.actionType?"追加":"更新"},tableHeaders(){return[{text:"順序",value:"order",sortable:!1},{text:"メールアドレス",value:"email",sortable:!1},{text:"氏名",value:"name",sortable:!1},{text:"操作",value:"actions",sortable:!1}]},footerProps(){return{itemsPerPageText:"",itemsPerPageOptions:[30,-1]}}},methods:{...(0,k.nv)({addDocument:"firestore/addDocument",updateDocument:"firestore/updateDocument",fetchAllCollections:"firestore/fetchAllCollections"}),open(e,t,s){this.show=!0,this.actionType=e,this.currentTabName=s,this.getDepartments(),this.getUsers(),this.resetForm(t)},onClickClose(){this.show=!1},async onClickAction(){const e={id:this.id,request_type:this.currentTabName,department:this.department,title:this.title,approvers:this.approvers},t=this.currentTableName;"add"===this.actionType?await this.addDocument({item:e,currentTableName:t}):await this.updateDocument({item:e,currentTableName:t}),this.show=!1},addApprover(){const e={order:this.approvers.length+1,email:this.userInfo.id,name:this.userInfo.name};this.approvers.push(e),this.userInfo=[]},deleteApprover(e){const t=this.approvers,s=t.indexOf(e);t.splice(s,1)},resetForm(e={}){this.id=e.id||"",this.department=e.department||"",this.title=e.title||"",this.approvers=e.approvers||[],this.readers=e.readers||[],this.$refs.form.resetValidation()},async getDepartments(){const e="departments";await this.fetchAllCollections({currentTableName:e})},async getUsers(){const e="users";await this.fetchAllCollections({currentTableName:e})}}},et=Xe,tt=(0,T.Z)(et,Ge,Ke,!1,null,null,null),st=tt.exports,at={name:"Routes",data(){return{currentTableName:"routes",title:"申請ルート設定",search:"",tableData:[],currentTabName:"paid_leave"}},components:{ItemDialogRoutes:st,DeleteDialog:Fe},computed:{...(0,k.rn)({routes:e=>e.firestore.routes}),tableHeaders(){return[{text:"部署",value:"department",sortable:!0},{text:"タイトル",value:"title",sortable:!1},{text:"操作",value:"actions",sortable:!1}]},footerProps(){return{itemsPerPageText:"",itemsPerPageOptions:[30,-1]}}},methods:{...(0,k.nv)({fetchCollectionsByOneQuery:"firestore/fetchCollectionsByOneQuery"}),onClickTab(e){this.setCurrentTabName(e),this.getRecords()},onClickAdd(){const e=this.currentTabName;this.$refs.ItemDialogRoutes.open("add",{},e)},onClickEdit(e){const t=this.currentTabName;this.$refs.ItemDialogRoutes.open("edit",e,t)},onClickDelete(e){const t=this.currentTableName;this.$refs.deleteDialog.open(e,t)},async getRecords(){const e=this.currentTableName,t={field:"request_type",compare:"==",value:this.currentTabName};await this.fetchCollectionsByOneQuery({currentTableName:e,customQuery:t}),this.tableData=this.routes},setCurrentTabName(e){this.currentTabName=e}},created(){this.getRecords()}},rt=at,it=(0,T.Z)(rt,Qe,ze,!1,null,null,null),ot=it.exports,nt=function(){var e=this,t=e._self._c;return t("div",[t(C.Z,[t(R.EB,[t(I.Z,{attrs:{cols:"8"}},[t("div",{staticClass:"h5"},[e._v(" "+e._s(e.title)+" ")])]),t(f.Z),t(I.Z,{staticClass:"text-right",attrs:{cols:"4"}},[t(n.Z,{attrs:{dark:"",color:"green"},on:{click:e.onClickAdd}},[t(Y.Z,[e._v("mdi-plus")])],1)],1),t(I.Z,{attrs:{cols:"12"}},[t(O.Z,{attrs:{"append-icon":"mdi-magnify",label:"Search","single-line":"","hide-details":""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1)],1),t(V.Z,{staticClass:"text-no-wrap",attrs:{headers:e.tableHeaders,items:e.tableData,search:e.search,"footer-props":e.footerProps,"sort-by":"name","sort-desc":!1,"items-per-page":30,"mobile-breakpoint":"0"},scopedSlots:e._u([{key:"item.actions",fn:function({item:s}){return[t(Y.Z,{on:{click:function(t){return e.onClickDelete(s)}}},[e._v("mdi-delete")])]}}],null,!0)})],1),t("ItemDialogAdmins",{ref:"ItemDialogAdmins"}),t("DeleteDialog",{ref:"deleteDialog"})],1)},lt=[],ct=function(){var e=this,t=e._self._c;return t(X.Z,{attrs:{scrollable:"",persistent:"","max-width":"500px",eager:""},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[t(C.Z,[t(R.EB,[e._v(e._s(e.titleText))]),t(ee.Z),t(R.ZB,[t(P.Z,{ref:"form",model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[t(te.Z,{attrs:{label:"管理者",items:e.users,"item-text":e=>`${e.name} (${e.id})`,"return-object":""},model:{value:e.userInfo,callback:function(t){e.userInfo=t},expression:"userInfo"}})],1)],1),t(ee.Z),t(R.h7,[t(f.Z),t(n.Z,{attrs:{color:"grey darken-1",text:""},on:{click:e.onClickClose}},[e._v(" キャンセル ")]),t(n.Z,{attrs:{color:"blue darken-1",text:"",disabled:!e.valid},on:{click:e.onClickAction}},[e._v(" "+e._s(e.actionText)+" ")])],1)],1)],1)},ut=[],dt={name:"ItemDialogAdmins",data(){return{currentTableName:"admins",show:!1,valid:!1,menu:!1,actionType:"add",userInfo:"",id:"",email:"",name:""}},computed:{...(0,k.rn)({users:e=>e.firestore.users}),titleText(){return"add"===this.actionType?"データ追加":"データ編集"},actionText(){return"add"===this.actionType?"追加":"更新"}},methods:{...(0,k.nv)({fetchAllCollections:"firestore/fetchAllCollections",addDocumentWithTextId:"firestore/addDocumentWithTextId",updateDocument:"firestore/updateDocument"}),open(e,t){this.show=!0,this.actionType=e,this.getUsers(),this.resetForm(t)},onClickClose(){this.show=!1},async onClickAction(){const e={id:this.userInfo.id,name:this.userInfo.name},t=this.currentTableName;"add"===this.actionType?await this.addDocumentWithTextId({item:e,currentTableName:t}):await this.updateDocument({item:e,currentTableName:t}),this.show=!1},resetForm(e={}){this.id=e.id||"",this.userInfo={name:e.name,email:e.email}||"",this.$refs.form.resetValidation()},async getUsers(){const e="users";await this.fetchAllCollections({currentTableName:e})}}},mt=dt,ht=(0,T.Z)(mt,ct,ut,!1,null,null,null),pt=ht.exports,ft={name:"Admins",components:{ItemDialogAdmins:pt,DeleteDialog:Fe},data(){return{currentTableName:"admins",title:"管理者一覧",search:"",tableData:[]}},computed:{...(0,k.rn)({admins:e=>e.firestore.admins}),tableHeaders(){return[{text:"氏名",value:"name",sortable:!1},{text:"操作",value:"actions",sortable:!1}]},footerProps(){return{itemsPerPageText:"",itemsPerPageOptions:[30,-1]}}},methods:{...(0,k.nv)({fetchAllCollections:"firestore/fetchAllCollections"}),onClickAdd(){this.$refs.ItemDialogAdmins.open("add")},onClickEdit(e){this.$refs.ItemDialogAdmins.open("edit",e)},onClickDelete(e){const t=this.currentTableName;this.$refs.deleteDialog.open(e,t)},async getRecords(){const e=this.currentTableName;await this.fetchAllCollections({currentTableName:e}),this.tableData=this.admins}},async created(){await this.getRecords()}},bt=ft,vt=(0,T.Z)(bt,nt,lt,!1,null,null,null),gt=vt.exports,kt=function(){var e=this,t=e._self._c;return t("div",[t(C.Z,[t(R.EB,[t(I.Z,{attrs:{cols:"8"}},[t("div",{staticClass:"h5"},[e._v(" "+e._s(e.title)+" ")])]),t(f.Z),t(I.Z,{staticClass:"text-right",attrs:{cols:"4"}},[t(n.Z,{attrs:{dark:"",color:"green"},on:{click:e.onClickAdd}},[t(Y.Z,[e._v("mdi-plus")])],1)],1),t(I.Z,{attrs:{cols:"12"}},[t(O.Z,{attrs:{"append-icon":"mdi-magnify",label:"Search","single-line":"","hide-details":""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1)],1),t(V.Z,{staticClass:"text-no-wrap",attrs:{headers:e.tableHeaders,items:e.tableData,search:e.search,"footer-props":e.footerProps,"sort-by":"department","sort-desc":!1,"items-per-page":30,"mobile-breakpoint":"0"},scopedSlots:e._u([{key:"item.actions",fn:function({item:s}){return[t(Y.Z,{staticClass:"mr-2",on:{click:function(t){return e.onClickEdit(s)}}},[e._v("mdi-pencil")]),t(Y.Z,{on:{click:function(t){return e.onClickDelete(s)}}},[e._v("mdi-delete")])]}}],null,!0)})],1),t("ItemDialogUsers",{ref:"ItemDialogUsers"}),t("DeleteDialog",{ref:"deleteDialog"})],1)},yt=[],Zt=function(){var e=this,t=e._self._c;return t(X.Z,{attrs:{scrollable:"",persistent:"","max-width":"500px",eager:""},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[t(C.Z,[t(R.EB,[e._v(e._s(e.titleText))]),t(ee.Z),t(R.ZB,[t(P.Z,{ref:"form",model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[t(te.Z,{attrs:{label:"部署",rules:e.departmentRules,items:e.departments,"item-text":"department","item-value":"department"},model:{value:e.department,callback:function(t){e.department=t},expression:"department"}}),t(O.Z,{attrs:{label:"メールアドレス",rules:e.emailRules,readonly:"edit"==e.actionType},model:{value:e.email,callback:function(t){e.email=t},expression:"email"}}),t(O.Z,{attrs:{label:"氏名",rules:e.nameRules},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1)],1),t(ee.Z),t(R.h7,[t(f.Z),t(n.Z,{attrs:{color:"grey darken-1",text:""},on:{click:e.onClickClose}},[e._v(" キャンセル ")]),t(n.Z,{attrs:{color:"blue darken-1",text:"",disabled:!e.valid},on:{click:e.onClickAction}},[e._v(" "+e._s(e.actionText)+" ")])],1)],1)],1)},Tt=[],_t={name:"ItemDialogUsers",data(){return{currentTableName:"users",show:!1,valid:!1,menu:!1,actionType:"add",id:"",department:"",email:"",name:"",departmentRules:[e=>e.trim().length>0||"部署は必須です"],emailRules:[e=>e.trim().length>0||"メールアドレスは必須です",e=>e.trim().length<=32||"メールアドレスは32文字以内で入力してください"],nameRules:[e=>e.trim().length>0||"氏名は必須です",e=>e.trim().length<=32||"氏名は32文字以内で入力してください"]}},computed:{...(0,k.rn)({departments:e=>e.firestore.departments}),titleText(){return"add"===this.actionType?"データ追加":"データ編集"},actionText(){return"add"===this.actionType?"追加":"更新"}},methods:{...(0,k.nv)({addDocumentWithTextId:"firestore/addDocumentWithTextId",updateDocument:"firestore/updateDocument",fetchAllCollections:"firestore/fetchAllCollections"}),open(e,t){this.show=!0,this.actionType=e,this.getDepartments(),this.resetForm(t)},onClickClose(){this.show=!1},async onClickAction(){const e={id:this.email,department:this.department,name:this.name},t=this.currentTableName;"add"===this.actionType?await this.addDocumentWithTextId({item:e,currentTableName:t}):await this.updateDocument({item:e,currentTableName:t}),this.show=!1},resetForm(e={}){this.id=e.id||"",this.department=e.department||"",this.email=e.id||"",this.name=e.name||"",this.$refs.form.resetValidation()},async getDepartments(){const e="departments";await this.fetchAllCollections({currentTableName:e})}}},wt=_t,Dt=(0,T.Z)(wt,Zt,Tt,!1,null,null,null),xt=Dt.exports,Ct={name:"Users",components:{ItemDialogUsers:xt,DeleteDialog:Fe},data(){return{currentTableName:"users",title:"従業員一覧",search:"",tableData:[]}},computed:{...(0,k.rn)({users:e=>e.firestore.users}),tableHeaders(){return[{text:"部署",value:"department",sortable:!0},{text:"メールアドレス",value:"id",sortable:!1},{text:"氏名",value:"name",sortable:!1},{text:"操作",value:"actions",sortable:!1}]},footerProps(){return{itemsPerPageText:"",itemsPerPageOptions:[30,-1]}}},methods:{...(0,k.nv)({fetchAllCollections:"firestore/fetchAllCollections"}),onClickAdd(){this.$refs.ItemDialogUsers.open("add")},onClickEdit(e){this.$refs.ItemDialogUsers.open("edit",e)},onClickDelete(e){const t=this.currentTableName;this.$refs.deleteDialog.open(e,t)},async getRecords(){const e=this.currentTableName;await this.fetchAllCollections({currentTableName:e}),this.tableData=this.users}},created(){this.getRecords()}},Rt=Ct,It=(0,T.Z)(Rt,kt,yt,!1,null,null,null),qt=It.exports,At=function(){var e=this,t=e._self._c;return t("div",[t(q.Z,[t(I.Z,{attrs:{col:"12"}},[t(C.Z,[t(R.EB,[e._v(e._s(e.title))]),t(R.ZB,[t(f.Z)],1),t(R.h7,[t(n.Z,{attrs:{dark:"",color:"green"},on:{click:e.onClickSend}},[t(Y.Z,{attrs:{left:""}},[e._v("mdi-send")]),e._v(" メール送信 ")],1)],1)],1)],1)],1)],1)},Nt=[],Ut={name:"Test",data(){return{title:"メールテスト"}},computed:{...(0,k.Se)({getUserEmail:"firebase/getUserEmail"})},methods:{...(0,k.nv)({sendEmail:"firestore/sendEmail"}),async onClickSend(){const e={to:this.getUserEmail,subject:"テストです。",body:"テスト送信です！"};await this.sendEmail({emailConfig:e})}},created(){}},Et=Ut,$t=(0,T.Z)(Et,At,Nt,!1,null,null,null),St=$t.exports;a.ZP.use(D.ZP);const Pt=[{path:"/",name:"RequestOverview",component:pe,meta:{requiresAuth:!0}},{path:"/my/requests/:id",name:"myRequestDetail",component:qe,meta:{requiresAuth:!0}},{path:"/others/requests/:id",name:"othersRequestDetail",component:qe,meta:{requiresAuth:!0}},{path:"/login",name:"Login",component:S,beforeEnter(e,t,s){const a=(0,x.v0)();(0,x.Aj)(a,(e=>{e?s("/"):s()}))}},{path:"/settings",name:"Settings",component:F,meta:{requiresAuth:!0}},{path:"/departments",name:"Departments",component:Ye,meta:{requiresAuth:!0}},{path:"/routes",name:"Routes",component:ot,meta:{requiresAuth:!0}},{path:"/admins",name:"Admins",component:gt,meta:{requiresAuth:!0}},{path:"/users",name:"Users",component:qt,meta:{requiresAuth:!0}},{path:"/test",name:"Test",component:St,meta:{requiresAuth:!0}}],Ot=new D.ZP({mode:"history",base:"/vue-gas-workflow/",routes:Pt});Ot.beforeEach(((e,t,s)=>{const a=e.matched.some((e=>e.meta.requiresAuth));if(a){const t=(0,x.v0)();(0,x.Aj)(t,(t=>{t?s():s({path:"/login",query:{redirect:e.fullPath}})}))}else s()}));var Bt=Ot,Mt=s(9669),jt=s.n(Mt);const Ht=jt().create({headers:{"content-type":"text/plain"}});Ht.interceptors.response.use((e=>e.data.error?Promise.reject(e.data.error):Promise.resolve(e)),(e=>Promise.reject(e)));let Jt="";const Ft=e=>{Jt=e};let Wt="";const Lt=e=>{Wt=e},Vt=e=>Ht.post(Jt,{method:"POST",authToken:Wt,params:{emailConfig:e}});var Yt={setUrl:Ft,setAuthToken:Lt,sendEmail:Vt};const Qt={settings:{appName:"ワークフロー",apiUrl:"",authToken:""}},zt={saveSettings(e,{settings:t}){e.settings={...t};const{appName:s,apiUrl:a,authToken:r}=e.settings;document.title=s,Yt.setUrl(a),Yt.setAuthToken(r),localStorage.setItem("settings",JSON.stringify(t))},loadSettings(e){const t=JSON.parse(localStorage.getItem("settings"));t&&(e.settings=Object.assign(e.settings,t));const{appName:s,apiUrl:a,authToken:r}=e.settings;document.title=s,Yt.setUrl(a),Yt.setAuthToken(r)}},Gt={saveSettings({commit:e},{settings:t}){e("saveSettings",{settings:t})},loadSettings({commit:e}){e("loadSettings")}},Kt={};var Xt={namespaced:!0,state:Qt,mutations:zt,actions:Gt,getters:Kt};const es={loggedIn:!1,userUid:"",userName:"",userIcon:"",userEmail:"",authMessage:""},ts={setLoginStatus(e,t){e.loggedIn=t},setUserUid(e,t){e.userUid=t},setUserName(e,t){e.userName=t},setUserIcon(e,t){e.userIcon=t},setUserEmail(e,t){e.userEmail=t},setAuthMessage(e,t){e.authMessage=t}},ss={async login({commit:e}){console.log("login action");const t=new x.hJ,s=(0,x.v0)();await(0,x.rh)(s,t).then((t=>{const s=t.user;e("setUserUid",s.uid),e("setUserName",s.displayName),e("setUserIcon",s.photoURL),e("setUserEmail",s.email),e("setAuthMessage","ログインしました。"),console.log("login success")})).catch((e=>{const t=e.code,s=e.message;console.log("login error: ",t,s)})),await(0,x.Fb)(s,x.a$).then((()=>{console.log("keeping state")})).catch((e=>{const t=e.code,s=e.message;console.log("keeping state error: ",t,s)}))},logout({commit:e}){const t=(0,x.v0)();(0,x.w7)(t).then((()=>{e("setAuthMessage","ログアウトしました。"),console.log("logout success"),e("setLoginStatus",!1)})).catch((e=>{console.log("logout error",e)}))},onAuth({commit:e}){const t=(0,x.v0)();(0,x.Aj)(t,(t=>{t=t||{},e("setUserUid",t.uid),e("setUserName",t.displayName),e("setLoginStatus",!!t.uid),e("setUserIcon",t.photoURL),e("setUserEmail",t.email),console.log("onAuth")}))}},as={getLoginStatus(e){return e.loggedIn},getUserUid(e){return e.userUid},getUserName(e){return e.userName},getUserIcon(e){return e.userIcon},getUserEmail(e){return e.userEmail}};var rs={namespaced:!0,state:es,mutations:ts,actions:ss,getters:as},is=s(5503),os=s(6257);const ns={apiKey:"AIzaSyCheZvfsN7MBNDc2gAPcwbH9uXREw8vlJo",authDomain:"vue-gas-workflow-auth.firebaseapp.com",projectId:"vue-gas-workflow-auth",storageBucket:"vue-gas-workflow-auth.appspot.com",messagingSenderId:"1046023525328",appId:"1:1046023525328:web:b7e1344c644108f2ccdfd5"},ls=(0,is.ZF)(ns),cs=(0,os.ad)(ls);var us=cs;const ds={workflowMessage:"",requests:[],myRequests:[],othersRequests:[],details:[],users:[],departments:[],routes:[],admins:[],userInfo:"",arrayRoute:[],selectedTabName:""},ms={setWorkflowMessage(e,t){e.workflowMessage=t},setCollections(e,{collections:t,currentTableName:s}){e[s]=t},addDocument(e,{item:t,currentTableName:s}){const a=e[s];a.push(t)},updateDocument(e,{item:t,currentTableName:s}){const a=e[s],r=a.findIndex((e=>e.id===t.id));a.splice(r,1,t)},deleteDocument(e,{id:t,currentTableName:s}){const a=e[s],r=a.findIndex((e=>e.id===t));a.splice(r,1)},setUserInfo(e,{userInfo:t}){e.userInfo=t},setArrayRoute(e,{route:t}){e.arrayRoute=t},setSelectedTabName(e,{selectedTabName:t}){e.selectedTabName=t}},hs={async fetchAllCollections({commit:e},{currentTableName:t}){const s=(0,os.IO)((0,os.hJ)(us,t)),a=await(0,os.PL)(s),r=[];a.forEach((e=>{r.push({...e.data(),id:e.id})})),e("setCollections",{collections:r,currentTableName:t})},async addDocument({commit:e},{item:t,currentTableName:s}){const a=(0,os.hJ)(us,s),r=await(0,os.ET)(a,t),i=await(0,os.QT)(r),o={...i.data(),id:i.id};e("addDocument",{item:o,currentTableName:s}),e("setWorkflowMessage","データを追加しました。")},async addDocumentWithTextId({commit:e},{item:t,currentTableName:s}){const a=(0,os.JU)(us,s,t.id);await(0,os.pl)(a,t);const r=await(0,os.QT)(a),i=r.data();e("addDocument",{item:i,currentTableName:s})},async updateDocument({commit:e},{item:t,currentTableName:s}){const a=(0,os.JU)(us,s,t.id);await(0,os.r7)(a,t),e("updateDocument",{item:t,currentTableName:s}),e("setWorkflowMessage","データを更新しました。")},async deleteDocument({commit:e},{item:t,currentTableName:s}){const a=t.id,r=(0,os.JU)(us,s,t.id);await(0,os.oe)(r,t),e("deleteDocument",{id:a,currentTableName:s}),e("setWorkflowMessage","データを削除しました。")},async fetchCollectionsByOneQuery({commit:e},{currentTableName:t,customQuery:s}){const a=(0,os.IO)((0,os.hJ)(us,t),(0,os.ar)(s.field,s.compare,s.value)),r=await(0,os.PL)(a),i=[];r.forEach((e=>{i.push({...e.data(),id:e.id})})),e("setCollections",{collections:i,currentTableName:t})},async fetchCollectionByDocId({commit:e},{currentTableName:t,docId:s}){const a=(0,os.JU)(us,t,s),r=await(0,os.QT)(a),i={...r.data(),id:r.id};e("setCollections",{collections:i,currentTableName:t})},async fetchMyDetail({commit:e},{userId:t,docId:s}){const a=(0,os.JU)(us,"users",t,"requests",s,"details",s),r=await(0,os.QT)(a),i=r.data();e("setCollections",{collections:i,currentTableName:"details"})},async fetchOthersDetail({commit:e},{userId:t,docId:s}){const a=(0,os.IO)((0,os.B$)(us,"details"),(0,os.ar)("id","==",s),(0,os.ar)("current_approver_email","==",t)),r=await(0,os.PL)(a),i=[];r.forEach((e=>{i.push({...e.data(),id:e.id})}));const o=i[0];e("setCollections",{collections:o,currentTableName:"details"})},async fetchRequest({commit:e},{userId:t,docId:s}){const a=(0,os.JU)(us,"users",t,"requests",s),r=await(0,os.QT)(a),i=r.data();e("setCollections",{collections:i,currentTableName:"requests"})},async fetchMyRequests({commit:e},{userId:t}){const s=(0,os.hJ)(us,"users",t,"requests"),a=await(0,os.PL)(s),r=[];a.forEach((e=>{r.push({...e.data(),id:e.id})})),e("setCollections",{collections:r,currentTableName:"myRequests"})},async fetchOthersRequests({commit:e},{userId:t}){const s=(0,os.IO)((0,os.B$)(us,"requests"),(0,os.ar)("current_approver_email","==",t)),a=await(0,os.PL)(s),r=[];a.forEach((e=>{r.push({...e.data(),id:e.id})})),e("setCollections",{collections:r,currentTableName:"othersRequests"})},async batchAddSubCollectionsToUsers({commit:e},{uid:t,userId:s,item:a}){const r=(0,os.qs)(us),i=(0,os.JU)(us,"users",s,"requests",t),o=(0,os.JU)(us,"users",s,"requests",t,"details",t);r.set(i,a.request),r.set(o,a.detail),await r.commit();const n=await(0,os.QT)(i),l={...n.data(),id:t};e("addDocument",{item:l,currentTableName:"myRequests"}),e("setWorkflowMessage","申請を提出しました。")},async batchUpdateDocuments({commit:e},{userId:t,docId:s,itemRequest:a,itemDetail:r,operationType:i}){const o=(0,os.qs)(us),n=(0,os.JU)(us,"users",t,"requests",s),l=(0,os.JU)(us,"users",t,"requests",s,"details",s);o.set(n,a),o.set(l,r),await o.commit(),e("setCollections",{collections:a,currentTableName:"requests"}),e("setCollections",{collections:r,currentTableName:"details"}),e("setWorkflowMessage",`申請を${i}しました。`)},async fetchUserInfo({commit:e},{userId:t}){const s=await(0,os.QT)((0,os.JU)(us,"users",t)),a=s.data();e("setUserInfo",{userInfo:a})},async createArrayRoute({commit:e},{requestTypeValue:t,department:s}){const a=await ps(t,s);e("setArrayRoute",{route:a})},setSelectedTabName({commit:e},{selectedTabName:t}){e("setSelectedTabName",{selectedTabName:t})},async sendEmail({commit:e},{emailConfig:t}){await Yt.sendEmail(t),e("setWorkflowMessage","メール送信しました。")}};async function ps(e,t){const s="routes",a=(0,os.IO)((0,os.hJ)(us,s),(0,os.ar)("request_type","==",e),(0,os.ar)("department","==",t)),r=await(0,os.PL)(a),i=[];return r.forEach((e=>{i.push({...e.data(),id:e.id})})),i}const fs={getArrayRoute(e){return e.arrayRoute}};var bs={namespaced:!0,state:ds,mutations:ms,actions:hs,getters:fs};a.ZP.use(k.ZP);var vs=new k.ZP.Store({modules:{workflow:Xt,firebase:rs,firestore:bs}}),gs=s(1705);a.ZP.use(gs.Z);var ks=new gs.Z({});a.ZP.config.productionTip=!1;const ys=async()=>{await vs.dispatch("firebase/onAuth"),new a.ZP({router:Bt,store:vs,vuetify:ks,render:e=>e(w)}).$mount("#app")};ys()}},t={};function s(a){var r=t[a];if(void 0!==r)return r.exports;var i=t[a]={exports:{}};return e[a](i,i.exports,s),i.exports}s.m=e,function(){var e=[];s.O=function(t,a,r,i){if(!a){var o=1/0;for(u=0;u<e.length;u++){a=e[u][0],r=e[u][1],i=e[u][2];for(var n=!0,l=0;l<a.length;l++)(!1&i||o>=i)&&Object.keys(s.O).every((function(e){return s.O[e](a[l])}))?a.splice(l--,1):(n=!1,i<o&&(o=i));if(n){e.splice(u--,1);var c=r();void 0!==c&&(t=c)}}return t}i=i||0;for(var u=e.length;u>0&&e[u-1][2]>i;u--)e[u]=e[u-1];e[u]=[a,r,i]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};s.O.j=function(t){return 0===e[t]};var t=function(t,a){var r,i,o=a[0],n=a[1],l=a[2],c=0;if(o.some((function(t){return 0!==e[t]}))){for(r in n)s.o(n,r)&&(s.m[r]=n[r]);if(l)var u=l(s)}for(t&&t(a);c<o.length;c++)i=o[c],s.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return s.O(u)},a=self["webpackChunkvue_gas_workflow"]=self["webpackChunkvue_gas_workflow"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=s.O(void 0,[998],(function(){return s(4399)}));a=s.O(a)})();
//# sourceMappingURL=app.1537c76c.js.map